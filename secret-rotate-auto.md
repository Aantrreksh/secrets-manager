---

copyright:
  years: 2020, 2021
lastupdated: "2021-12-02"

keywords: automatically rotate, automatic rotation, set rotation policy

subcollection: secrets-manager

---

{:codeblock: .codeblock}
{:screen: .screen}
{:download: .download}
{:external: target="_blank" .external}
{:faq: data-hd-content-type='faq'}
{:gif: data-image-type='gif'}
{:important: .important}
{:note: .note}
{:pre: .pre}
{:tip: .tip}
{:preview: .preview}
{:deprecated: .deprecated}
{:beta: .beta}
{:term: .term}
{:shortdesc: .shortdesc}
{:script: data-hd-video='script'}
{:support: data-reuse='support'}
{:table: .aria-labeledby="caption"}
{:troubleshoot: data-hd-content-type='troubleshoot'}
{:help: data-hd-content-type='help'}
{:tsCauses: .tsCauses}
{:tsResolve: .tsResolve}
{:tsSymptoms: .tsSymptoms}
{:video: .video}
{:step: data-tutorial-type='step'}
{:tutorial: data-hd-content-type='tutorial'}
{:api: .ph data-hd-interface='api'}
{:cli: .ph data-hd-interface='cli'}
{:ui: .ph data-hd-interface='ui'}
{:curl: .ph data-hd-programlang='curl'}
{:java: .ph data-hd-programlang='java'}
{:ruby: .ph data-hd-programlang='ruby'}
{:c#: .ph data-hd-programlang='c#'}
{:objectc: .ph data-hd-programlang='Objective C'}
{:python: .ph data-hd-programlang='python'}
{:javascript: .ph data-hd-programlang='javascript'}
{:php: .ph data-hd-programlang='PHP'}
{:swift: .ph data-hd-programlang='swift'}
{:curl: .ph data-hd-programlang='curl'}
{:dotnet-standard: .ph data-hd-programlang='dotnet-standard'}
{:go: .ph data-hd-programlang='go'}
{:unity: .ph data-hd-programlang='unity'}
{:release-note: data-hd-content-type='release-note'}

# Automatically rotating secrets
{: #automatic-rotation}

You can schedule automatic rotation for secrets by using {{site.data.keyword.secrets-manager_full}}.
{: shortdesc}

When you rotate a secret in your service instance, you create a new version of its value. By scheduling automatic rotation of your secrets at regular intervals, you can reduce the likelihood of compromise and ensure that your credentials never expire.

Automatic rotation is available only for secrets that are generated by {{site.data.keyword.secrets-manager_short}}. If the secret was imported initially, you must provide new secret data to rotate it. For more information, see [Manually rotating secrets](/docs/secrets-manager?topic=secrets-manager-manual-rotation).
{: note}



## Before you begin
{: #before-auto-rotate}

Before you get started, be sure that you have the required level of access. To rotate secrets, you need the [**Writer** service role or higher](/docs/secrets-manager?topic=secrets-manager-iam).

### Supported secret types
{: #before-auto-rotate-supported-secret-types}

Automatic rotation is supported for [user credentials](/docs/secrets-manager?topic=secrets-manager-user-credentials) and [public certificates](/docs/secrets-manager?topic=secrets-manager-certificates#order-certificates). Depending on the type of secret, automatic rotation takes place immediately on the date and time that you set, or it might need to complete a few extra steps before a new version of the secret can be created.

User credentials
:   On each rotation, {{site.data.keyword.secrets-manager_short}} replaces the existing `password` value with a randomly generated 32-character password that contains uppercase letters, lowercase letters, digits, and symbols. The `username` value does not change.

Public certificates
:   On each rotation, the certificate moves to the **Active, Rotation pending** status to indicate that the request to renew the certificate is being processed. {{site.data.keyword.secrets-manager_short}} uses DNS validation to verify that you own the domains that are listed as part of the certificate. This process can take a few minutes to complete. If the validation completes successfully, a new certificate is issued and its status changes back to **Active**. If the validation doesn't complete successfully, the status of the certificate changes to **Active, Rotation failed**. 

   Automatic rotation or renewal of certificates is supported for public certificates, which are certificates that are ordered through {{site.data.keyword.secrets-manager_short}} from a third-party, such as Let's Encrypt. If you need to rotate an imported certificate, see [Manually rotating secrets](/docs/secrets-manager?topic=secrets-manager-manual-rotation).
   {: note}

## Scheduling automatic rotation in the UI
{: #schedule-auto-rotate-ui}
{: ui}

You can schedule the automatic rotation of secrets by using the {{site.data.keyword.secrets-manager_short}} UI. 



### Scheduling rotation for user credentials
{: #schedule-auto-rotate-password-ui}

If you prefer to schedule your passwords to be automatically rotated at regular intervals, you can enable automatic rotation for your user credentials at their creation, or by editing the details of an existing secret. Choose between a 30, 60, or 90-day rotation interval.

If you need more control over the rotation frequency of a secret, you can use the {{site.data.keyword.secrets-manager_short}} API to set a custom interval by using `day` or `month` units of time. For more information, see the [API reference](/apidocs/secrets-manager#put-policy).
{: tip}

1. If you're [adding a secret](/docs/secrets-manager?topic=secrets-manager-user-credentials#user-credentials-ui), enable the rotation option by selecting a 30, 60, or 90-day rotation interval.
2. If you're editing an existing secret, enable automatic rotation by updating its details.
    1. In the **Secrets** table, view a list of your existing secrets.
    2. In the row for the secret that you want to edit, click the **Actions** menu ![Actions icon](../icons/actions-icon-vertical.svg) **> Edit details**.
    3. Use the **Automatic rotation** option to enable or disable automatic rotation for the secret.

### Scheduling rotation for public certificates
{: #schedule-auto-rotate-public-cert-ui}

If you prefer to schedule your public TLS certificates to be automatically renewed, you can enable automatic rotation for certificates when you order them, or by editing the details of an existing certificate. In the certificate's next rotation cycle, {{site.data.keyword.secrets-manager_short}} reorders the certificate 31 days before its expiry date. 

Certificates that expire in less than 31 days must also be [rotated manually](/docs/secrets-manager?topic=secrets-manager-manual-rotation) before rotation becomes automatic in the following cycles.
{: note}

1. If you're [ordering a certificate](/docs/secrets-manager?topic=secrets-manager-certificates#order-certificates), enable the rotation options.
   
   1. To rotate the certificate automatically, switch the rotation toggle to **On**. Your certificate is automatically reordered 31 days before its expiration date.
   2. To request a new private key for the certificate on each rotation, switch the rekey toggle to **On**.
2. If you're editing an existing public certificate, schedule automatic rotation by updating its details.
   1. In the **Secrets** table, view a list of your existing Public certificates.
   2. In the row for the certificate that you want to edit, click the **Actions** menu ![Actions icon](../icons/actions-icon-vertical.svg) **> Edit details**.
   3. Use the **Automatic rotation** option to add or remove a rotation policy for the secret.



## Scheduling automatic rotation with the API
{: #schedule-auto-rotate-api}
{: api}

You can schedule the automatic rotation of secrets by using the {{site.data.keyword.secrets-manager_short}} API. 

### Scheduling rotation for user credentials
{: #schedule-auto-rotate-password-api}

The following example request creates an automatic rotation policy for a user credentials (`username_password`) secret. When you call the API, replace the ID variables and IAM token with the values that are specific to your {{site.data.keyword.secrets-manager_short}} instance.
{: curl}

If you're using the [{{site.data.keyword.secrets-manager_short}} Java SDK](https://github.com/IBM/secrets-manager-java-sdk){: external}, you can call the `updateSecret` method to rotate a secret. The following code shows an example call to rotate user credentials.
{: java}

If you're using the [{{site.data.keyword.secrets-manager_short}} Node.js SDK](https://github.com/IBM/secrets-manager-nodejs-sdk){: external}, you can call the `updateSecret(params)` method to rotate a secret. The following code shows an example call to rotate user credentials.
{: javascript}

If you're using the [{{site.data.keyword.secrets-manager_short}} Python SDK](https://github.com/IBM/secrets-manager-python-sdk){: external}, you can call the `update_secret(params)` method to rotate a secret. The following code shows an example call to rotate user credentials.
{: python}



```sh
curl -X PUT "https://{instance_ID}.{region}.secrets-manager.appdomain.cloud/api/v1/secrets/username_password/{id}/policies" \
    -H "Authorization: Bearer $IAM_TOKEN" \
    -H "Accept: application/json" \
    -H "Content-Type: application/json" \
    -d '{ 
        "metadata": { 
          "collection_type": "application/vnd.ibm.secrets-manager.secret.policy+json", "collection_total": 1 
        }, 
        "resources": [ 
          { 
            "type": "application/vnd.ibm.secrets-manager.secret.policy+json", 
            "rotation": { 
              "interval": 1, 
              "unit": "month" 
            } 
          } 
        ] 
      }'
```
{: codeblock}
{: curl}

```java
CollectionMetadata collectionMetadataModel = new CollectionMetadata.Builder()
  .collectionType("application/vnd.ibm.secrets-manager.config+json")
  .collectionTotal(Long.valueOf("1"))
  .build();
SecretPolicyRotationRotationPolicyRotation secretPolicyRotationRotationModel = new SecretPolicyRotationRotationPolicyRotation.Builder()
  .interval(Long.valueOf("1"))
  .unit("day")
  .build();
SecretPolicyRotation secretPolicyRotationModel = new SecretPolicyRotation.Builder()
  .type("application/vnd.ibm.secrets-manager.secret.policy+json")
  .rotation(secretPolicyRotationRotationModel)
  .build();
PutPolicyOptions putPolicyOptions = new PutPolicyOptions.Builder()
  .secretType("username_password")
  .id("testString")
  .metadata(collectionMetadataModel)
  .resources(new java.util.ArrayList<SecretPolicyRotation>(java.util.Arrays.asList(secretPolicyRotationModel)))
  .build();

Response<GetSecretPolicies> response = secretsManagerService.putPolicy(putPolicyOptions).execute();
GetSecretPolicies getSecretPolicies = response.getResult();

System.out.println(getSecretPolicies);
```
{: codeblock}
{: java}

```javascript
// Request models needed by this operation.

// CollectionMetadata
const collectionMetadataModel = {
  collection_type: 'application/vnd.ibm.secrets-manager.config+json',
  collection_total: 1,
};

// SecretPolicyRotationRotationPolicyRotation
const secretPolicyRotationRotationModel = {
  interval: 1,
  unit: 'day',
};

// SecretPolicyRotation
const secretPolicyRotationModel = {
  type: 'application/vnd.ibm.secrets-manager.secret.policy+json',
  rotation: secretPolicyRotationRotationModel,
};

const params = {
  secretType: 'username_password',
  id: 'testString',
  metadata: collectionMetadataModel,
  resources: [secretPolicyRotationModel],
};

let res;
try {
  res = await secretsManagerService.putPolicy(params);
  console.log(JSON.stringify(res.result, null, 2));
} catch (err) {
  console.warn(err);
}
```
{: codeblock}
{: javascript}

```python
collectionMetadataModel := &secretsmanagerv1.CollectionMetadata{
  CollectionType: core.StringPtr("application/vnd.ibm.secrets-manager.config+json"),
  CollectionTotal: core.Int64Ptr(int64(1)),
}

secretPolicyRotationRotationModel := &secretsmanagerv1.SecretPolicyRotationRotationPolicyRotation{
  Interval: core.Int64Ptr(int64(1)),
  Unit: core.StringPtr("day"),
}

secretPolicyRotationModel := &secretsmanagerv1.SecretPolicyRotation{
  Type: core.StringPtr("application/vnd.ibm.secrets-manager.secret.policy+json"),
  Rotation: secretPolicyRotationRotationModel,
}

putPolicyOptions := secretsManagerService.NewPutPolicyOptions(
  "username_password",
  "testString",
  collectionMetadataModel,
  []secretsmanagerv1.SecretPolicyRotation{*secretPolicyRotationModel},
)

getSecretPolicies, response, err := secretsManagerService.PutPolicy(putPolicyOptions)
if err != nil {
  panic(err)
}
b, _ := json.MarshalIndent(getSecretPolicies, "", "  ")
fmt.Println(string(b))
```
{: codeblock}
{: python}

A successful response returns the ID value for the secret, along with other metadata. For more information about the required and optional request parameters, see the [API reference](/apidocs/secrets-manager#update-secret).

### Setting an automatic rotation policy for public certificates
{: #schedule-auto-rotate-public-cert-api}

If you prefer to schedule your certificates to be automatically renewed, you can enable automatic rotation for certificates when you order them, or by editing the details of an existing certificate. In the certificate's next rotation cycle, {{site.data.keyword.secrets-manager_short}} reorders the certificate 31 days before its expiry date.

#### Ordering a public certificate that renews automatically
{: #order-auto-rotate-public-cert-api}

The following example request orders a certificate with automatic rotation enabled. When you call the API, set the `auto_rotate` property to `true`. Optionally, you can set `rotate_keys` to `true` to request a new private key for the certificate on each rotation.
{: curl}



Certificates that expires in less than 31 days must also be rotated manually before rotation becomes automatic in the following cycles.
{: note}

```sh
curl -X POST "https://{instance_ID}.{region}.secrets-manager.appdomain.cloud/api/v1/secrets/public_cert" \
    -H "Authorization: Bearer $IAM_TOKEN" \
    -H "Accept: application/json" \
    -H "Content-Type: application/json" \
    -d '{
      "metadata": {
        "collection_type": "application/vnd.ibm.secrets-manager.secret+json",
        "collection_total": 1
      },
      "resources": [
        {
          "name": "example-certificate-with-auto-rotation",
          "description": "Extended description for my secret.",
          "secret_group_id": "432b91f1-ff6d-4b47-9f06-82debc236d90",
          "ca": "my-ca-configuration-name",
          "dns": "my-dns-configuration-name",
          "labels": [
            "dev",
            "us-south"
          ],
          "common_name": "certificate-common-name.com",
          "alt_names": [
            "www.certificate-common-name.com"
          ],
          "bundle_certs": false,
          "key_algorithm": "RSA2048",
          "rotation": {
            "auto_rotate": true,
            "rotate_keys": true
          }
        }
      ]
    }'
```
{: codeblock}
{: curl}



A successful response returns the ID value for the certificate, along with other metadata. For more information about the required and optional request parameters, check out the [API reference](/apidocs/secrets-manager#create-secret).
